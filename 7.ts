{
  // Part 1
  const data = [
    "......................................................................S......................................................................",
    ".............................................................................................................................................",
    "......................................................................^......................................................................",
    ".............................................................................................................................................",
    ".....................................................................^.^.....................................................................",
    ".............................................................................................................................................",
    "....................................................................^.^.^....................................................................",
    ".............................................................................................................................................",
    "...................................................................^...^.^...................................................................",
    ".............................................................................................................................................",
    "..................................................................^.^.^...^..................................................................",
    ".............................................................................................................................................",
    ".................................................................^...^.^.^.^.................................................................",
    ".............................................................................................................................................",
    "................................................................^.^.^.^.^.^.^................................................................",
    ".............................................................................................................................................",
    "...............................................................^.^.^...^.^...^...............................................................",
    ".............................................................................................................................................",
    "..............................................................^.^.^...^.^.^...^..............................................................",
    ".............................................................................................................................................",
    ".............................................................^.^.^.....^.^.^.^.^.............................................................",
    ".............................................................................................................................................",
    "............................................................^.^.^.^...^.^.....^.^............................................................",
    ".............................................................................................................................................",
    "...........................................................^.^.......^...^.^.^.^.^...........................................................",
    ".............................................................................................................................................",
    "..........................................................^.^...^.^.^...^.^.^.^.^.^..........................................................",
    ".............................................................................................................................................",
    ".........................................................^.^.^...^.^.^.^.^.^.^.^.^.^.........................................................",
    ".............................................................................................................................................",
    "........................................................^.^.^.^.........^.^...^...^.^........................................................",
    ".............................................................................................................................................",
    ".......................................................^.^.^...^.^.....^.^.^.......^.^.......................................................",
    ".............................................................................................................................................",
    "......................................................^.^.....^.^.^.....^.^.^.....^.^.^......................................................",
    ".............................................................................................................................................",
    ".....................................................^...^.^.^.^.^.^.....^.^.^.^.^.^.^.^.....................................................",
    ".............................................................................................................................................",
    "....................................................^.^...^...^.^.^.^.^.^.^.....^.^.....^....................................................",
    ".............................................................................................................................................",
    "...................................................^.^...^.^.^.^...^...^.....^.^...^.....^...................................................",
    ".............................................................................................................................................",
    "..................................................^.......^.^...^.^.^.^.^.^.....^.^...^...^..................................................",
    ".............................................................................................................................................",
    ".................................................^...^.....^...^...^...^.^.^.^...^.^.^.^...^.................................................",
    ".............................................................................................................................................",
    "................................................^.^.^.^.^...^.....^...^.^.^.^.^.^.^...^.^.^.^................................................",
    ".............................................................................................................................................",
    "...............................................^.^.^.^.......^...^...^.^.^...^.^.^.^.^...^.^.^...............................................",
    ".............................................................................................................................................",
    "..............................................^.^.^...^.^.^.^.^...^.^.....^.^.^.^.^.....^.^.^.^..............................................",
    ".............................................................................................................................................",
    ".............................................^.^.^.^.^.^.^...^.^.....^.^.^.^.^...^.....^...^.^.^.............................................",
    ".............................................................................................................................................",
    "............................................^.^.^.^.^.^.^...^.^.^...^.............^.....^.....^.^............................................",
    ".............................................................................................................................................",
    "...........................................^.^.^.....^...^.^.^.^...^.^...^.....^...^.....^.^.^.^.^...........................................",
    ".............................................................................................................................................",
    "..........................................^.^.^.^.^.^.^.^.^...^.^...^.^.......^.^.....^.^.^...^.^.^..........................................",
    ".............................................................................................................................................",
    ".........................................^...^.^.^.......^.....^...^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.........................................",
    ".............................................................................................................................................",
    "........................................^.^.^.^.^.^.....^...^.....^.^.....^.^.^.^.^...^...^.^.^.^...^........................................",
    ".............................................................................................................................................",
    ".......................................^.^.^.^.^.^.^.^.^.^.^.^.^.^.......^.......^.^.....^...^.^...^.^.......................................",
    ".............................................................................................................................................",
    "......................................^.^.^.^.^.^.^...^.^...^.^.^...^...^.....^.^.......^.^.....^...^.^......................................",
    ".............................................................................................................................................",
    ".....................................^.^.^.^.^.^.^.^...^...^.^.^.^...^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.....................................",
    ".............................................................................................................................................",
    "....................................^...^.^...^...^.^.....^.^...^.^.^.^.^...^.^.^.^.^...^.^.^.^...^.^.^.^....................................",
    ".............................................................................................................................................",
    "...................................^.^...^...^.^.....^.....^.....^...^.^.^.^.^...^.^.^.^...^...^.^.^.^...^...................................",
    ".............................................................................................................................................",
    "..................................^...^.^.^.^.....^...^.....^.^.^.........^.^.^.....^.^.^.^.^...^.^.^.^.^.^..................................",
    ".............................................................................................................................................",
    ".................................^.....^.^.^.......^.^.....^.^.^.^.......^.^.^...^.....^.......^.^...^.....^.................................",
    ".............................................................................................................................................",
    "................................^...^.^.^.^.^.^.^.^.....^...^.....^.^.^.....^.^...^.^.^.....^.^.......^.^.^.^................................",
    ".............................................................................................................................................",
    "...............................^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^...^.........^.^.^.^.....^.^.^.^...^...^.^...............................",
    ".............................................................................................................................................",
    "..............................^...^.............^...^.^...^...^.^.....^.^.....^...^.^...^.^.^...^...^.^.^.^...^..............................",
    ".............................................................................................................................................",
    ".............................^...^...^...^...^.^.^.^.........^...^.....^.^.^.^.^.^.^.^.....^.......^.^...^...^.^.............................",
    ".............................................................................................................................................",
    "............................^.^.^.^.^.^.....^.^...^.^.............^.^.^.^.^.^...^.^.^...^.^...^...^.^.^...^...^.^............................",
    ".............................................................................................................................................",
    "...........................^...^...^...^.^.^.^.......^.^.^...^...^...^.^.^...^.^.^...^.^.......^.^.^.^.^.^.....^.^...........................",
    ".............................................................................................................................................",
    "..........................^.^.^.^.^.^.^.^...^.^...^.^...^.^.......^.^...^.^.^.^...^.^...^...^.^...^.^.^.^.^.^.^...^..........................",
    ".............................................................................................................................................",
    ".........................^.....^.^.....^.^...^...^.^.^...^.......^.^.^...^.^.....^.....^...^.^...^.....^...^.^.^.^.^.........................",
    ".............................................................................................................................................",
    "........................^.^.^.^.^.^.^.^.^.....^...^...^...^.^.^.^...^.......^.......^...^...^.^.^...^.^.....^...^.^.^........................",
    ".............................................................................................................................................",
    ".......................^.^...^.^.....^.^...^.....^.^.^.^.^.^.^...........^.......^.^.^.......^.^.^.^.^.^.....^.......^.......................",
    ".............................................................................................................................................",
    "......................^.....^...^.^...^.^.^...^.^.^...^.^...^.^.^...^.....^...^.....^.^.^.^.^.^...^.....^.^.^.^...^.^.^......................",
    ".............................................................................................................................................",
    ".....................^.^.^.^...^.^...^...^.^...^.^.^.^.^.^...^.^.^.^...^.^.......^.^...^.........^.^.^.^...^.....^.^.^.^.....................",
    ".............................................................................................................................................",
    "....................^.^.^.^.^.^...^...........^.^.^.^.^.......^.....^.^...^...^.^.^...^.^.^.^...^.^.^.^.^...^.....^.^...^....................",
    ".............................................................................................................................................",
    "...................^.^.....^.^.^.^.^.^.^.^.^.^.^.......^.....^.........^.^.^.^.^.^.^.^.^.....^.^.^...^.^.^...^.^...^.^.^.^...................",
    ".............................................................................................................................................",
    "..................^.......^.^...^.^...^.^.^.....^.^.^.^.....^.......^...^.^.....^.^.....^.^...^.^.^.^.^.....^.^.^.......^.^..................",
    ".............................................................................................................................................",
    ".................^...^.^.^.^.^.....^.^.^...^.^...^...^...^.^.^.^.^.^...^.....^.^.^...^.^.....^.^.^.^.^.^.^.^.^.....^.......^.................",
    ".............................................................................................................................................",
    "................^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^...^...^.^.^...^.^.^...^...^.^.....^...^.^.^.^...^.^.....^.^................",
    ".............................................................................................................................................",
    "...............^...^.^.^.^.^.^.^...^.^.....^...^.^.....^.^.....^.^.....^.^.^.^...^.^.^...^.^.....^.^.....^.....^.....^.^.^.^.^...............",
    ".............................................................................................................................................",
    "..............^.^.^...^.........^.^.^.^...^.......^.^.^.^.....^.^.^.^.....^.^.^.....^.^.^.........^.....^.^...^.^...^.^.^.^.^.^..............",
    ".............................................................................................................................................",
    ".............^.^.^.^...^...^.^...^...^.......^.^.^.....^.^.^.^...^...^.^.^.........^.....^.^.....^.......^.^.......^.^.^.^.^.^.^.............",
    ".............................................................................................................................................",
    "............^...^.^.^...............^.^.^.^...^.^.^.^.......^...^.^.^...^.^.^.^...^.^.^.^...^.^.....^.^.^...^.^.....^.^.^.^.^.^.^............",
    ".............................................................................................................................................",
    "...........^.^.^...^.^...^.^.^.^...^.^...^.^.^.....^...^.....^.^.^.^.^...^.^.^.^.....^.^...^.^...^.....^.^.^...^.^.......^...^.^.^...........",
    ".............................................................................................................................................",
    "..........^.^.^.^...^.^.^...^...^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.......^...^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^..........",
    ".............................................................................................................................................",
    ".........^.....^.^...^.^.....^.^.^...^.^.^...^.^.....^.^.^...^.^.^.^...^.^.^.^.^.^...^...^.^.^.^.^.^.^.....^.^...^.^.^.^...^.^.^...^.........",
    ".............................................................................................................................................",
    "........^...^.^.^.^.^.^.^.^.....^.^.^...^.^.........^.^.^.^.......^...^...^.^.^.^.^...^...^...^...^.......^...^.^.^.^.^...^.^.^.^.^.^........",
    ".............................................................................................................................................",
    ".......^.....^.^.^...^.^...^...^.....^...^.^.......^.....^.^.^.^.^.^.^.^.......^.^.^.^...^...^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.......",
    ".............................................................................................................................................",
    "......^.^.^.^.^.^...^.^.^.^.^.^.^...^...^.^.^.^.....^.^...^...^.^...^.^.^...^.....^.......^.^.^.....^...^.^.^...^...^.^...^.^...^.^...^......",
    ".............................................................................................................................................",
    ".....^...^.......^.^.^.^.^.^.^...^...^...^.^.^...^.^.^.^...^...^.^.^.....^.^.....^...^.....^.....^.^.^...^.^.^...^.^.^...^...^...^.^...^.....",
    ".............................................................................................................................................",
    "....^.^.^...^.^...^.^...^.^...^.^...^.^.^...^.....^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^...^.^...^.^.^...^.^.^.^.^...^...^.^.^.....^....",
    ".............................................................................................................................................",
    "...^.^...^.^.^.^...^.^.^.^.^.^.^...........^.^.^.^...^...^.^.^...^.^.....^.^.^.^.....^...^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.......^...",
    ".............................................................................................................................................",
    "..^.^.^.^...^...^.^.^.....^.^.^.^.^...^.^.^.^...^...^.^.^.^...^...^.......^.^.^.^.^.^.^.^.^.^.^...^.^.^...^...^.^...^...^.^.^.^...^.^.^...^..",
    ".............................................................................................................................................",
    ".^.^.^.......^.....^.^.............^...^.....^.^.^.^.^.........^.^.^.........^.^.^.^.^.^.^...^...^.^...^.......^.^...^.^.^.^...^.^.^...^.^.^.",
    "............................................................................................................................................."
  ];

  const testData = [
    ".......S.......",
    "...............",
    ".......^.......",
    "...............",
    "......^.^......",
    "...............",
    ".....^.^.^.....",
    "...............",
    "....^.^...^....",
    "...............",
    "...^.^...^.^...",
    "...............",
    "..^...^.....^..",
    "...............",
    ".^.^.^.^.^...^.",
    "..............."
  ];

  // Source switch between real puzzle input and example input
  const rows = testData;

  let totalSplits = 0;

  rows.forEach((row, rowIndex) => {
    const lastRow = rows[rowIndex - 1];

    let lastRowChars: string[];
    if (lastRow) {
      lastRowChars = lastRow.split("");
    }

    const chars = row.split("");

    chars.forEach((char, charIndex) => {
      if (lastRowChars && (lastRowChars[charIndex] === "|" || lastRowChars[charIndex] === "S")) {
        if (char !== "^") {
          chars[charIndex] = "|";
        } else {
          chars[charIndex - 1] = "|";
          chars[charIndex + 1] = "|";
          totalSplits += 1;
        }
      }
    });

    rows[rowIndex] = chars.join("");
  });

  rows.forEach((row) => console.log(row));
  console.log(totalSplits);
}

{
  // Part 2
  const data = [
    "......................................................................^......................................................................",
    ".............................................................................................................................................",
    ".....................................................................^.^.....................................................................",
    ".............................................................................................................................................",
    "....................................................................^.^.^....................................................................",
    ".............................................................................................................................................",
    "...................................................................^...^.^...................................................................",
    ".............................................................................................................................................",
    "..................................................................^.^.^...^..................................................................",
    ".............................................................................................................................................",
    ".................................................................^...^.^.^.^.................................................................",
    ".............................................................................................................................................",
    "................................................................^.^.^.^.^.^.^................................................................",
    ".............................................................................................................................................",
    "...............................................................^.^.^...^.^...^...............................................................",
    ".............................................................................................................................................",
    "..............................................................^.^.^...^.^.^...^..............................................................",
    ".............................................................................................................................................",
    ".............................................................^.^.^.....^.^.^.^.^.............................................................",
    ".............................................................................................................................................",
    "............................................................^.^.^.^...^.^.....^.^............................................................",
    ".............................................................................................................................................",
    "...........................................................^.^.......^...^.^.^.^.^...........................................................",
    ".............................................................................................................................................",
    "..........................................................^.^...^.^.^...^.^.^.^.^.^..........................................................",
    ".............................................................................................................................................",
    ".........................................................^.^.^...^.^.^.^.^.^.^.^.^.^.........................................................",
    ".............................................................................................................................................",
    "........................................................^.^.^.^.........^.^...^...^.^........................................................",
    ".............................................................................................................................................",
    ".......................................................^.^.^...^.^.....^.^.^.......^.^.......................................................",
    ".............................................................................................................................................",
    "......................................................^.^.....^.^.^.....^.^.^.....^.^.^......................................................",
    ".............................................................................................................................................",
    ".....................................................^...^.^.^.^.^.^.....^.^.^.^.^.^.^.^.....................................................",
    ".............................................................................................................................................",
    "....................................................^.^...^...^.^.^.^.^.^.^.....^.^.....^....................................................",
    ".............................................................................................................................................",
    "...................................................^.^...^.^.^.^...^...^.....^.^...^.....^...................................................",
    ".............................................................................................................................................",
    "..................................................^.......^.^...^.^.^.^.^.^.....^.^...^...^..................................................",
    ".............................................................................................................................................",
    ".................................................^...^.....^...^...^...^.^.^.^...^.^.^.^...^.................................................",
    ".............................................................................................................................................",
    "................................................^.^.^.^.^...^.....^...^.^.^.^.^.^.^...^.^.^.^................................................",
    ".............................................................................................................................................",
    "...............................................^.^.^.^.......^...^...^.^.^...^.^.^.^.^...^.^.^...............................................",
    ".............................................................................................................................................",
    "..............................................^.^.^...^.^.^.^.^...^.^.....^.^.^.^.^.....^.^.^.^..............................................",
    ".............................................................................................................................................",
    ".............................................^.^.^.^.^.^.^...^.^.....^.^.^.^.^...^.....^...^.^.^.............................................",
    ".............................................................................................................................................",
    "............................................^.^.^.^.^.^.^...^.^.^...^.............^.....^.....^.^............................................",
    ".............................................................................................................................................",
    "...........................................^.^.^.....^...^.^.^.^...^.^...^.....^...^.....^.^.^.^.^...........................................",
    ".............................................................................................................................................",
    "..........................................^.^.^.^.^.^.^.^.^...^.^...^.^.......^.^.....^.^.^...^.^.^..........................................",
    ".............................................................................................................................................",
    ".........................................^...^.^.^.......^.....^...^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.........................................",
    ".............................................................................................................................................",
    "........................................^.^.^.^.^.^.....^...^.....^.^.....^.^.^.^.^...^...^.^.^.^...^........................................",
    ".............................................................................................................................................",
    ".......................................^.^.^.^.^.^.^.^.^.^.^.^.^.^.......^.......^.^.....^...^.^...^.^.......................................",
    ".............................................................................................................................................",
    "......................................^.^.^.^.^.^.^...^.^...^.^.^...^...^.....^.^.......^.^.....^...^.^......................................",
    ".............................................................................................................................................",
    ".....................................^.^.^.^.^.^.^.^...^...^.^.^.^...^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.....................................",
    ".............................................................................................................................................",
    "....................................^...^.^...^...^.^.....^.^...^.^.^.^.^...^.^.^.^.^...^.^.^.^...^.^.^.^....................................",
    ".............................................................................................................................................",
    "...................................^.^...^...^.^.....^.....^.....^...^.^.^.^.^...^.^.^.^...^...^.^.^.^...^...................................",
    ".............................................................................................................................................",
    "..................................^...^.^.^.^.....^...^.....^.^.^.........^.^.^.....^.^.^.^.^...^.^.^.^.^.^..................................",
    ".............................................................................................................................................",
    ".................................^.....^.^.^.......^.^.....^.^.^.^.......^.^.^...^.....^.......^.^...^.....^.................................",
    ".............................................................................................................................................",
    "................................^...^.^.^.^.^.^.^.^.....^...^.....^.^.^.....^.^...^.^.^.....^.^.......^.^.^.^................................",
    ".............................................................................................................................................",
    "...............................^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^...^.........^.^.^.^.....^.^.^.^...^...^.^...............................",
    ".............................................................................................................................................",
    "..............................^...^.............^...^.^...^...^.^.....^.^.....^...^.^...^.^.^...^...^.^.^.^...^..............................",
    ".............................................................................................................................................",
    ".............................^...^...^...^...^.^.^.^.........^...^.....^.^.^.^.^.^.^.^.....^.......^.^...^...^.^.............................",
    ".............................................................................................................................................",
    "............................^.^.^.^.^.^.....^.^...^.^.............^.^.^.^.^.^...^.^.^...^.^...^...^.^.^...^...^.^............................",
    ".............................................................................................................................................",
    "...........................^...^...^...^.^.^.^.......^.^.^...^...^...^.^.^...^.^.^...^.^.......^.^.^.^.^.^.....^.^...........................",
    ".............................................................................................................................................",
    "..........................^.^.^.^.^.^.^.^...^.^...^.^...^.^.......^.^...^.^.^.^...^.^...^...^.^...^.^.^.^.^.^.^...^..........................",
    ".............................................................................................................................................",
    ".........................^.....^.^.....^.^...^...^.^.^...^.......^.^.^...^.^.....^.....^...^.^...^.....^...^.^.^.^.^.........................",
    ".............................................................................................................................................",
    "........................^.^.^.^.^.^.^.^.^.....^...^...^...^.^.^.^...^.......^.......^...^...^.^.^...^.^.....^...^.^.^........................",
    ".............................................................................................................................................",
    ".......................^.^...^.^.....^.^...^.....^.^.^.^.^.^.^...........^.......^.^.^.......^.^.^.^.^.^.....^.......^.......................",
    ".............................................................................................................................................",
    "......................^.....^...^.^...^.^.^...^.^.^...^.^...^.^.^...^.....^...^.....^.^.^.^.^.^...^.....^.^.^.^...^.^.^......................",
    ".............................................................................................................................................",
    ".....................^.^.^.^...^.^...^...^.^...^.^.^.^.^.^...^.^.^.^...^.^.......^.^...^.........^.^.^.^...^.....^.^.^.^.....................",
    ".............................................................................................................................................",
    "....................^.^.^.^.^.^...^...........^.^.^.^.^.......^.....^.^...^...^.^.^...^.^.^.^...^.^.^.^.^...^.....^.^...^....................",
    ".............................................................................................................................................",
    "...................^.^.....^.^.^.^.^.^.^.^.^.^.^.......^.....^.........^.^.^.^.^.^.^.^.^.....^.^.^...^.^.^...^.^...^.^.^.^...................",
    ".............................................................................................................................................",
    "..................^.......^.^...^.^...^.^.^.....^.^.^.^.....^.......^...^.^.....^.^.....^.^...^.^.^.^.^.....^.^.^.......^.^..................",
    ".............................................................................................................................................",
    ".................^...^.^.^.^.^.....^.^.^...^.^...^...^...^.^.^.^.^.^...^.....^.^.^...^.^.....^.^.^.^.^.^.^.^.^.....^.......^.................",
    ".............................................................................................................................................",
    "................^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^...^...^.^.^...^.^.^...^...^.^.....^...^.^.^.^...^.^.....^.^................",
    ".............................................................................................................................................",
    "...............^...^.^.^.^.^.^.^...^.^.....^...^.^.....^.^.....^.^.....^.^.^.^...^.^.^...^.^.....^.^.....^.....^.....^.^.^.^.^...............",
    ".............................................................................................................................................",
    "..............^.^.^...^.........^.^.^.^...^.......^.^.^.^.....^.^.^.^.....^.^.^.....^.^.^.........^.....^.^...^.^...^.^.^.^.^.^..............",
    ".............................................................................................................................................",
    ".............^.^.^.^...^...^.^...^...^.......^.^.^.....^.^.^.^...^...^.^.^.........^.....^.^.....^.......^.^.......^.^.^.^.^.^.^.............",
    ".............................................................................................................................................",
    "............^...^.^.^...............^.^.^.^...^.^.^.^.......^...^.^.^...^.^.^.^...^.^.^.^...^.^.....^.^.^...^.^.....^.^.^.^.^.^.^............",
    ".............................................................................................................................................",
    "...........^.^.^...^.^...^.^.^.^...^.^...^.^.^.....^...^.....^.^.^.^.^...^.^.^.^.....^.^...^.^...^.....^.^.^...^.^.......^...^.^.^...........",
    ".............................................................................................................................................",
    "..........^.^.^.^...^.^.^...^...^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.......^...^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^..........",
    ".............................................................................................................................................",
    ".........^.....^.^...^.^.....^.^.^...^.^.^...^.^.....^.^.^...^.^.^.^...^.^.^.^.^.^...^...^.^.^.^.^.^.^.....^.^...^.^.^.^...^.^.^...^.........",
    ".............................................................................................................................................",
    "........^...^.^.^.^.^.^.^.^.....^.^.^...^.^.........^.^.^.^.......^...^...^.^.^.^.^...^...^...^...^.......^...^.^.^.^.^...^.^.^.^.^.^........",
    ".............................................................................................................................................",
    ".......^.....^.^.^...^.^...^...^.....^...^.^.......^.....^.^.^.^.^.^.^.^.......^.^.^.^...^...^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.......",
    ".............................................................................................................................................",
    "......^.^.^.^.^.^...^.^.^.^.^.^.^...^...^.^.^.^.....^.^...^...^.^...^.^.^...^.....^.......^.^.^.....^...^.^.^...^...^.^...^.^...^.^...^......",
    ".............................................................................................................................................",
    ".....^...^.......^.^.^.^.^.^.^...^...^...^.^.^...^.^.^.^...^...^.^.^.....^.^.....^...^.....^.....^.^.^...^.^.^...^.^.^...^...^...^.^...^.....",
    ".............................................................................................................................................",
    "....^.^.^...^.^...^.^...^.^...^.^...^.^.^...^.....^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^...^.^...^.^.^...^.^.^.^.^...^...^.^.^.....^....",
    ".............................................................................................................................................",
    "...^.^...^.^.^.^...^.^.^.^.^.^.^...........^.^.^.^...^...^.^.^...^.^.....^.^.^.^.....^...^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.......^...",
    ".............................................................................................................................................",
    "..^.^.^.^...^...^.^.^.....^.^.^.^.^...^.^.^.^...^...^.^.^.^...^...^.......^.^.^.^.^.^.^.^.^.^.^...^.^.^...^...^.^...^...^.^.^.^...^.^.^...^..",
    ".............................................................................................................................................",
    ".^.^.^.......^.....^.^.............^...^.....^.^.^.^.^.........^.^.^.........^.^.^.^.^.^.^...^...^.^...^.......^.^...^.^.^.^...^.^.^...^.^.^.",
    "............................................................................................................................................."
  ];

  const testData = [".......^.......", "......^.^......", ".....^.^.^.....", "....^.^...^....", "...^.^...^.^...", "..^...^.....^..", ".^.^.^.^.^...^."];

  // Source switch between real puzzle input and example input
  let rows = data;

  const activeTimelines = {} as Record<number, Record<number, number>>;

  const firstLeftTimeline = rows[0].indexOf("^") - 1;
  const firstRightTimeline = rows[0].indexOf("^") + 1;
  activeTimelines[0] = { [firstLeftTimeline]: 1, [firstRightTimeline]: 1 };

  rows.forEach((row, rowIndex) => {
    const chars = row.split("");

    chars.forEach((char, charIndex) => {
      if (activeTimelines[rowIndex - 1] && activeTimelines[rowIndex - 1][charIndex]) {
        activeTimelines[rowIndex] ??= {};
        if (char === "^") {
          activeTimelines[rowIndex][charIndex - 1] ??= 0;
          activeTimelines[rowIndex][charIndex + 1] ??= 0;

          activeTimelines[rowIndex][charIndex - 1] += activeTimelines[rowIndex - 1][charIndex];
          activeTimelines[rowIndex][charIndex + 1] += activeTimelines[rowIndex - 1][charIndex];
        } else {
          activeTimelines[rowIndex][charIndex] ??= 0;
          activeTimelines[rowIndex][charIndex] += activeTimelines[rowIndex - 1][charIndex];
        }
      }
    });
  });

  // 4404709551015 - Correct
  console.log(
    Object.values(activeTimelines[rows.length - 1]).reduce((prev, current) => {
      return prev + current;
    }, 0)
  );
}
